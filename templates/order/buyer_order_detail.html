{% extends 'base.html' %} 
{% load static %}

{% block head %}
<style>
    .disabledText {
        opacity: 0.4;
    }
    .disabledLink {
        pointer-events: none;
        opacity: 0.4;
    }
</style>
{% endblock %}

{% block content %}

<div class="container d-flex justify-content-center my-4">
    {% if title %}
    <h2>{{ title }}</h2>
    {% endif %}

</div>
<div class="container d-flex justify-content-center my-4">
    <div class="card" style="width: 40rem">
      <div class="card-body pb-0">
        <h3 class="card-title">Order ID: {{ object.id }}</h3>
        <table class="table table-borderless">
            <thead>
                <th scope="col">Order Item</th>
                <th scope="col">Quantity</th>
                <th scope="col">Price</th>
                <th scope="col">Seller</th>
                <th scope="col">Delivery Method</th>
            </thead>
            <tbody>
            {% for item in object.get_order_items.all %}
                <tr>
                    <td><a href="{% url 'plant:marketplace_plant_detail' item.user_plant.pk %}">
                        {{ item.user_plant.plant.scientific_name }}
                    </a></td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.user_plant.unit_price }}</td>
                    <td>{{ item.user_plant.user.username }}</td>
                    <td>{{ object.get_handling_display }}</td>
                </tr>
            {% endfor %}
            <tfoot>

                <tr style="border-top: thin solid lightgray;">
                    <td>Totals:</td>
                    <td>{{ total_num_items }}</td>
                    <td>{{ object.total_price }}</td>
                </tr>
            </tfoot>

            </tbody>
        </table>

        {% if object.handling == 'SH' %}
        <h5 class="mt-3">Shipping address:</h5>
        <p class="card-text mb-2">
            {{ object.address_for_shipping }}
        </p>
        {% else %}
        <h5 class="mt-3">Pickup address:</h5>
            {% if object.address_for_pickup %}
                <p class="card-text mb-2">
                {{ object.address_for_pickup }}
                </p>
            {% else %}
                <p>Pending - seller to enter pickup address.</p>
            {% endif %}
        {% endif %}
        

        <h5 class="mt-3">Order status:</h5>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <input class="form-check-input me-1" checked type="checkbox" value="" disabled>
                Order placed: {{ object.creation_date }}
            </li>
        {% if object.in_progress_date %}  
            <li class="list-group-item">
                <input class="form-check-input me-1" checked type="checkbox" value="" disabled>
                In progress: {{ object.in_progress_date }}
            </li>
        {% else %}
            <li class="list-group-item">
                <input class="form-check-input me-1"  type="checkbox" value="" disabled>
                In progress: Waiting on seller to acknowledge order
            </li>
        {% endif %}

        {% if object.fullfilled_date %}  
            <li class="list-group-item">
                <input class="form-check-input me-1" checked type="checkbox" value="" disabled>
                Order shipped: {{ object.fulfilled_date }}
            </li>
        {% else %}
            <li class="list-group-item">
                <input class="form-check-input me-1"  type="checkbox" value="" disabled>
                Order shipped: Waiting on seller to ship order
            </li>
        {% endif %}
        </ul>



        <!-- Allow authenticated BUYER to edit the order details -->
        {% if object.buyer == user and user.is_authenticated %}
            <!-- Only allow user it edit order if not in progress yet -->
            {% if object.status == 'CR' %}
            <div class="card-footer bg-white mb-0 ps-0" style="display: flex;">
                <a href="{{ object.get_buyer_update_url }}" class="btn custom-btn">Edit Order</a>
            </div>
            {% else %}
            <div class="card-footer bg-white mb-0 ps-0" style="display: flex;">
                <a href="{{ object.get_buyer_update_url }}" class="disabledLink btn custom-btn">Edit Order</a>
                <span class='form-text ms-2'>Order is in progress - unable to edit order, please contact seller. </span>
            </div>

            {% endif %}
        {% endif %}
      </div>
    </div>
</div>

<!-- Decorative green block div in background -->
<div class="decorative-bg-div"></div>

{% endblock %}